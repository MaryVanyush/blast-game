/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){var t,o,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function c(e,r,i,a){var c=r&&r.prototype instanceof l?r:l,u=Object.create(c.prototype);return n(u,"_invoke",function(e,n,r){var i,a,c,l=0,u=r||[],f=!1,h={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,a=0,c=t,h.n=n,s}};function d(e,n){for(a=e,c=n,o=0;!f&&l&&!r&&o<u.length;o++){var r,i=u[o],d=h.p,v=i[2];e>3?(r=v===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=d&&((r=e<2&&d<i[1])?(a=0,h.v=n,h.n=i[1]):d<v&&(r=e<3||i[0]>n||n>v)&&(i[4]=e,i[5]=n,h.n=v,a=0))}if(r||e>1)return s;throw f=!0,n}return function(r,u,v){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&d(u,v),a=u,c=v;(o=a<2?t:c)||!f;){i||(a?a<3?(a>1&&(h.n=-1),d(a,c)):h.n=c:h.v=c);try{if(l=2,i){if(a||(r="next"),o=i[r]){if(!(o=o.call(i,c)))throw TypeError("iterator result is not an object");if(!o.done)return o;c=o.value,a<2&&(a=0)}else 1===a&&(o=i.return)&&o.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);i=t}else if((o=(f=h.n<0)?c:e.call(n,h))!==s)break}catch(e){i=t,a=1,c=e}finally{l=1}}return{value:o,done:f}}}(e,i,a),!0),u}var s={};function l(){}function u(){}function f(){}o=Object.getPrototypeOf;var h=[][i]?o(o([][i]())):(n(o={},i,function(){return this}),o),d=f.prototype=l.prototype=Object.create(h);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,n(t,a,"GeneratorFunction")),t.prototype=Object.create(d),t}return u.prototype=f,n(d,"constructor",f),n(f,"constructor",u),u.displayName="GeneratorFunction",n(f,a,"GeneratorFunction"),n(d),n(d,a,"Generator"),n(d,i,function(){return this}),n(d,"toString",function(){return"[object Generator]"}),(e=function(){return{w:c,m:v}})()}function n(t,e,o,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}n=function(t,e,o,r){function a(e,o){n(t,e,function(t){return this._invoke(e,o,t)})}e?i?i(t,e,{value:o,enumerable:!r,configurable:!r,writable:!r}):t[e]=o:(a("next",0),a("throw",1),a("return",2))},n(t,e,o,r)}function o(t,e,n,o,r,i,a){try{var c=t[i](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,r)}function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,i(o.key),o)}}function i(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}var a,c=function(){function t(){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gameStarted=!1,this.animationId=null,this.lastTime=0,this.deltaTime=0,this.tiles=new Map,this.images=new Map,this.lastClickTime=0,this.lastClickCoords=null,this.effects=[],this.canvas=document.getElementById("gameCanvas"),!this.canvas)throw new Error("Canvas element not found");var e=this.canvas.getContext("2d");if(!e)throw new Error("Canvas context not available");this.ctx=e,this.setupEventListeners()}return n=t,i=[{key:"setupEventListeners",value:function(){var t=this;this.canvas.addEventListener("click",function(e){var n=t.canvas.getBoundingClientRect(),o=e.clientX-n.left,r=e.clientY-n.top;t.handleClick(o,r,"mouse")}),this.canvas.addEventListener("touchstart",function(e){e.preventDefault();var n=e.touches[0],o=t.canvas.getBoundingClientRect(),r=n.clientX-o.left,i=n.clientY-o.top;t.handleClick(r,i,"touch")})}},{key:"handleClick",value:function(t,e,n){var o=Date.now(),r={x:t,y:e};if(this.lastClickTime&&o-this.lastClickTime<300&&this.lastClickCoords&&Math.abs(r.x-this.lastClickCoords.x)<10&&Math.abs(r.y-this.lastClickCoords.y)<10)console.log("Ignoring duplicate ".concat(n," click at (").concat(t,", ").concat(e,")"));else{this.lastClickTime=o,this.lastClickCoords=r;var i=(this.canvas.width-300)/2,a=(this.canvas.height-400)/2,c=Math.floor((t-i)/50),s=Math.floor((e-a)/50);if(console.log("".concat(n," click at canvas (").concat(t,", ").concat(e,") -> board (").concat(c,", ").concat(s,")")),c>=0&&c<6&&s>=0&&s<8){var l="".concat(c,",").concat(s),u=this.tiles.get(l);if(u){console.log("Tile clicked: ".concat(u.type," at (").concat(c,", ").concat(s,")"));var f=new CustomEvent("tileClick",{detail:{x:c,y:s,type:u.type,tile:u}});document.dispatchEvent(f)}else console.log("No tile at (".concat(c,", ").concat(s,")"))}else console.log("Click outside board area: (".concat(c,", ").concat(s,")"))}}},{key:"loadImage",value:(c=e().m(function t(n){var o=this;return e().w(function(t){for(;;)switch(t.n){case 0:if(!this.images.has(n)){t.n=1;break}return t.a(2,this.images.get(n));case 1:return t.a(2,new Promise(function(t,e){var r=new Image;r.onload=function(){o.images.set(n,r),t(r)},r.onerror=e,r.src=n}))}},t,this)}),s=function(){var t=this,e=arguments;return new Promise(function(n,r){var i=c.apply(t,e);function a(t){o(i,n,r,a,s,"next",t)}function s(t){o(i,n,r,a,s,"throw",t)}a(void 0)})},function(t){return s.apply(this,arguments)})},{key:"createTile",value:function(t,e,n,o){var r="".concat(t,",").concat(e),i={x:t,y:e,type:n,imageSrc:o,element:null};return this.tiles.set(r,i),i}},{key:"removeTile",value:function(t,e){var n="".concat(t,",").concat(e);this.tiles.delete(n)}},{key:"updateTilePosition",value:function(t,e,n,o){var r="".concat(t,",").concat(e),i=this.tiles.get(r);i&&(this.tiles.delete(r),i.x=n,i.y=o,this.tiles.set("".concat(n,",").concat(o),i))}},{key:"start",value:function(){this.gameStarted||(this.gameStarted=!0,this.lastTime=performance.now(),this.gameLoop())}},{key:"stop",value:function(){this.gameStarted=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}},{key:"gameLoop",value:function(){var t=this;if(this.gameStarted){var e=performance.now();this.deltaTime=e-this.lastTime,this.lastTime=e,this.render(),this.animationId=requestAnimationFrame(function(){return t.gameLoop()})}}},{key:"render",value:function(){var t=this;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#1a1a2e",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);var e=(this.canvas.width-300)/2,n=(this.canvas.height-400)/2;this.tiles.forEach(function(o){var r=e+50*o.x,i=n+50*o.y;t.ctx.fillStyle="#2a2a4e",t.ctx.fillRect(r,i,50,50);var a=t.images.get(o.imageSrc);a?t.ctx.drawImage(a,r+5,i+5,40,40):(t.ctx.fillStyle="#fff",t.ctx.font="12px Arial",t.ctx.textAlign="center",t.ctx.fillText(o.type,r+25,i+25))}),this.updateEffects(),this.renderEffects()}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getContext",value:function(){return this.ctx}},{key:"getDeltaTime",value:function(){return this.deltaTime}},{key:"getAllTiles",value:function(){return this.tiles}},{key:"createBurnEffect",value:function(t,e){for(var n=(this.canvas.width-300)/2+50*t+25,o=(this.canvas.height-400)/2+50*e+25,r=[],i=0;i<15;i++){var a=2*Math.PI*i/15,c=2+3*Math.random();r.push({x:n,y:o,vx:Math.cos(a)*c,vy:Math.sin(a)*c-2*Math.random(),life:1,maxLife:1,size:3+4*Math.random(),color:Math.random()>.5?"#ff4444":"#ffaa00",alpha:1})}this.effects.push({x:n,y:o,type:"burn",particles:r,duration:1,maxDuration:1})}},{key:"createExplosionEffect",value:function(t,e){for(var n=(this.canvas.width-300)/2+50*t+25,o=(this.canvas.height-400)/2+50*e+25,r=[],i=0;i<25;i++){var a=Math.random()*Math.PI*2,c=3+5*Math.random();r.push({x:n,y:o,vx:Math.cos(a)*c,vy:Math.sin(a)*c,life:1,maxLife:1,size:2+6*Math.random(),color:Math.random()>.7?"#ffff00":"#ff6600",alpha:1})}this.effects.push({x:n,y:o,type:"explosion",particles:r,duration:1,maxDuration:1})}},{key:"updateEffects",value:function(){var t=this;this.effects=this.effects.filter(function(e){return e.duration-=t.deltaTime/1e3,e.particles=e.particles.filter(function(n){return n.x+=n.vx,n.y+=n.vy,n.life-=t.deltaTime/1e3,n.alpha=n.life/n.maxLife,"explosion"===e.type&&(n.vy+=.1),n.life>0}),e.duration>0&&e.particles.length>0})}},{key:"renderEffects",value:function(){var t=this;this.effects.forEach(function(e){e.particles.forEach(function(e){t.ctx.save(),t.ctx.globalAlpha=e.alpha,t.ctx.fillStyle=e.color,t.ctx.beginPath(),t.ctx.arc(e.x,e.y,e.size,0,2*Math.PI),t.ctx.fill(),t.ctx.shadowColor=e.color,t.ctx.shadowBlur=10,t.ctx.fill(),t.ctx.restore()})})}}],a=[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}],i&&r(n.prototype,i),a&&r(n,a),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,i,a,c,s}();function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function l(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function i(n,o,r,i){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return u(l,"_invoke",function(n,o,r){var i,c,s,l=0,u=r||[],f=!1,h={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,s=t,h.n=n,a}};function d(n,o){for(c=n,s=o,e=0;!f&&l&&!r&&e<u.length;e++){var r,i=u[e],d=h.p,v=i[2];n>3?(r=v===o)&&(s=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((r=n<2&&d<i[1])?(c=0,h.v=o,h.n=i[1]):d<v&&(r=n<3||i[0]>o||o>v)&&(i[4]=n,i[5]=o,h.n=v,c=0))}if(r||n>1)return a;throw f=!0,o}return function(r,u,v){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&d(u,v),c=u,s=v;(e=c<2?t:s)||!f;){i||(c?c<3?(c>1&&(h.n=-1),d(c,s)):h.n=s:h.v=s);try{if(l=2,i){if(c||(r="next"),e=i[r]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),c=1);i=t}else if((e=(f=h.n<0)?s:n.call(o,h))!==a)break}catch(e){i=t,c=1,s=e}finally{l=1}}return{value:e,done:f}}}(n,r,i),!0),l}var a={};function c(){}function s(){}function f(){}e=Object.getPrototypeOf;var h=[][o]?e(e([][o]())):(u(e={},o,function(){return this}),e),d=f.prototype=c.prototype=Object.create(h);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,u(t,r,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=f,u(d,"constructor",f),u(f,"constructor",s),s.displayName="GeneratorFunction",u(f,r,"GeneratorFunction"),u(d),u(d,r,"Generator"),u(d,o,function(){return this}),u(d,"toString",function(){return"[object Generator]"}),(l=function(){return{w:i,m:v}})()}function u(t,e,n,o){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}u=function(t,e,n,o){function i(e,n){u(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},u(t,e,n,o)}function f(t,e,n,o,r,i,a){try{var c=t[i](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,r)}function h(t){return function(){var e=this,n=arguments;return new Promise(function(o,r){var i=t.apply(e,n);function a(t){f(i,o,r,a,c,"next",t)}function c(t){f(i,o,r,a,c,"throw",t)}a(void 0)})}}function d(t,e,n){return(e=m(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function v(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,m(o.key),o)}}function m(t){var e=function(t){if("object"!=s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==s(e)?e:e+""}!function(t){t.STAR_BLUE="star_blue",t.STAR_GREEN="star_green",t.STAR_RED="star_red",t.STAR_PURPLE="star_purple",t.STAR_ORANGE="star_orange",t.BOMB="bomb"}(a||(a={}));var g=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.lastClickTime=0,this.lastClickCoords=null,this.config={boardWidth:6,boardHeight:8,targetScore:500,maxMoves:20,shuffleCount:3,bombCount:3},this.gameState={score:0,movesLeft:this.config.maxMoves,isGameOver:!1,isProcessing:!1,bombMode:!1},this.boosterState={shuffleCount:this.config.shuffleCount,bombCount:this.config.bombCount},this.tileImages=d(d(d(d(d(d({},a.STAR_BLUE,"src/img/block_blue.png"),a.STAR_GREEN,"src/img/block_green.png"),a.STAR_RED,"src/img/block_red.png"),a.STAR_PURPLE,"src/img/block_purpure.png"),a.STAR_ORANGE,"src/img/block_yellow.png"),a.BOMB,"src/img/icon_booster_bomb.png"),this.adapter=c.getInstance()},e=[{key:"initialize",value:(i=h(l().m(function t(){var e;return l().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,console.log("Initializing Blast Game with Cocos Creator 2.4.x..."),t.n=1,this.loadImages();case 1:return t.n=2,this.generateBoard();case 2:this.setupEventListeners(),this.hideLoadingScreen(),this.adapter.start(),this.updateUI(),console.log("Blast Game initialized successfully!"),t.n=4;break;case 3:t.p=3,e=t.v,console.error("Failed to initialize Blast Game:",e),this.showError("Ошибка инициализации игры");case 4:return t.a(2)}},t,this,[[0,3]])})),function(){return i.apply(this,arguments)})},{key:"loadImages",value:(r=h(l().m(function t(){var e,n=this;return l().w(function(t){for(;;)switch(t.n){case 0:return e=Object.values(this.tileImages).map(function(t){return n.adapter.loadImage(t)}),t.n=1,Promise.all(e);case 1:console.log("All images loaded successfully");case 2:return t.a(2)}},t,this)})),function(){return r.apply(this,arguments)})},{key:"generateBoard",value:(o=h(l().m(function t(){var e,n,o,r;return l().w(function(t){for(;;)switch(t.n){case 0:for(console.log("Generating board..."),this.adapter.getAllTiles().clear(),e=0;e<this.config.boardHeight;e++)for(n=0;n<this.config.boardWidth;n++)o=this.getRandomTileType(n,e),r=this.tileImages[o],this.adapter.createTile(n,e,o,r);console.log("Board generated successfully");case 1:return t.a(2)}},t,this)})),function(){return o.apply(this,arguments)})},{key:"getRandomTileType",value:function(t,e){if(this.getBombCount()>0){var n=[a.STAR_BLUE,a.STAR_GREEN,a.STAR_RED,a.STAR_PURPLE,a.STAR_ORANGE];return n[Math.floor(Math.random()*n.length)]}if(Math.random()<.05)return a.BOMB;var o=[a.STAR_BLUE,a.STAR_GREEN,a.STAR_RED,a.STAR_PURPLE,a.STAR_ORANGE];return o[Math.floor(Math.random()*o.length)]}},{key:"getBombCount",value:function(){var t=0;return this.adapter.getAllTiles().forEach(function(e){e.type===a.BOMB&&t++}),t}},{key:"setupEventListeners",value:function(){var t=this;document.addEventListener("tileClick",function(e){t.handleTileClick(e.detail)}),document.addEventListener("shuffleBoosterUsed",function(){t.useShuffleBooster()}),document.addEventListener("bombBoosterUsed",function(){t.useBombBooster()}),document.addEventListener("gameRestart",function(){t.restartGame()})}},{key:"handleTileClick",value:function(t){if(!this.gameState.isProcessing&&!this.gameState.isGameOver){var e=t.x,n=t.y,o=t.type,r=Date.now(),i={x:e,y:n};if(this.lastClickTime&&r-this.lastClickTime<200&&this.lastClickCoords&&this.lastClickCoords.x===i.x&&this.lastClickCoords.y===i.y)console.log("Ignoring duplicate game click at (".concat(e,", ").concat(n,")"));else{if(this.lastClickTime=r,this.lastClickCoords=i,console.log("Tile clicked at (".concat(e,", ").concat(n,") with type: ").concat(o)),this.gameState.bombMode)return this.handleBombBoosterClick(e,n),void(this.gameState.bombMode=!1);if(o!==a.BOMB){var c=this.findHorizontalGroup(e,n,o);c.length>=2?this.processTileGroup(c):console.log("No valid group to burn (need at least 2 tiles)")}else this.handleBombTileClick(e,n)}}}},{key:"findHorizontalGroup",value:function(t,e,n){for(var o=[],r=0;r<this.config.boardWidth;r++){var i=this.adapter.getAllTiles().get("".concat(r,",").concat(e));i&&i.type===n&&o.push(i)}if(o.length<2)return[];var a=[],c=this.adapter.getAllTiles().get("".concat(t,",").concat(e));if(!c)return[];a.push(c);for(var s=t-1;s>=0;s--){var l=this.adapter.getAllTiles().get("".concat(s,",").concat(e));if(!l||l.type!==n)break;a.unshift(l)}for(var u=t+1;u<this.config.boardWidth;u++){var f=this.adapter.getAllTiles().get("".concat(u,",").concat(e));if(!f||f.type!==n)break;a.push(f)}return console.log("Found continuous group of ".concat(a.length," tiles")),a}},{key:"handleBombTileClick",value:function(t,e){console.log("Bomb tile clicked at (".concat(t,", ").concat(e,")"));for(var n=[],o=0;o<this.config.boardWidth;o++){var r=this.adapter.getAllTiles().get("".concat(o,",").concat(e));r&&n.push(r)}this.burnTiles(n,!0),this.addScore(50),this.updateUI()}},{key:"handleBombBoosterClick",value:function(t,e){var n=this;console.log("Bomb booster used at (".concat(t,", ").concat(e,")"));var o=[],r=this.adapter.getAllTiles().get("".concat(t,",").concat(e));r&&o.push(r),[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}].forEach(function(r){var i=t+r.dx,a=e+r.dy;if(i>=0&&i<n.config.boardWidth&&a>=0&&a<n.config.boardHeight){var c=n.adapter.getAllTiles().get("".concat(i,",").concat(a));c&&o.push(c)}}),o.length>0&&(this.burnTiles(o,!0),this.addScore(30),this.updateUI())}},{key:"processTileGroup",value:(n=h(l().m(function t(e){var n;return l().w(function(t){for(;;)switch(t.n){case 0:if(!this.gameState.isProcessing){t.n=1;break}return t.a(2);case 1:this.gameState.isProcessing=!0;try{this.burnTiles(e),n=this.calculateScore(e.length),this.addScore(n),this.gameState.movesLeft--,this.updateUI(),this.checkGameConditions()}catch(t){console.error("Error processing tile group:",t)}finally{this.gameState.isProcessing=!1}case 2:return t.a(2)}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"burnTiles",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log("Burning ".concat(t.length," tiles")),t.forEach(function(t){n?e.adapter.createExplosionEffect(t.x,t.y):e.adapter.createBurnEffect(t.x,t.y)}),setTimeout(function(){t.forEach(function(t){e.adapter.removeTile(t.x,t.y)}),e.applyGravity(),e.fillEmptySpaces()},500)}},{key:"applyGravity",value:function(){var t=this;console.log("Applying gravity...");for(var e=function(e){for(var n=[],o=t.config.boardHeight-1;o>=0;o--){var r=t.adapter.getAllTiles().get("".concat(e,",").concat(o));r&&n.push(r)}for(var i=0;i<t.config.boardHeight;i++)t.adapter.removeTile(e,i);n.forEach(function(n,o){var r=t.config.boardHeight-1-o;t.adapter.createTile(e,r,n.type,n.imageSrc)})},n=0;n<this.config.boardWidth;n++)e(n);console.log("Gravity applied")}},{key:"fillEmptySpaces",value:function(){var t=this;console.log("Filling empty spaces..."),setTimeout(function(){for(var e=0;e<t.config.boardWidth;e++){for(var n=-1,o=0;o<t.config.boardHeight;o++)if(!t.adapter.getAllTiles().get("".concat(e,",").concat(o))){n=o;break}if(-1!==n)for(var r=n;r<t.config.boardHeight;r++)if(!t.adapter.getAllTiles().get("".concat(e,",").concat(r))){var i=t.getRandomTileType(e,r),a=t.tileImages[i];t.adapter.createTile(e,r,i,a)}}console.log("Empty spaces filled")},300)}},{key:"calculateScore",value:function(t){var e=10*t;return t>=5&&(e+=50),t>=7&&(e+=100),e}},{key:"addScore",value:function(t){this.gameState.score+=t}},{key:"checkGameConditions",value:function(){return this.gameState.score>=this.config.targetScore?(this.gameState.isGameOver=!0,void this.showGameOverModal(!0)):this.gameState.movesLeft<=0?(this.gameState.isGameOver=!0,void this.showGameOverModal(!1)):void 0}},{key:"updateUI",value:function(){var t=document.getElementById("scoreCount");t&&(t.textContent="".concat(this.gameState.score,"/").concat(this.config.targetScore));var e=document.getElementById("movesCount");e&&(e.textContent=this.gameState.movesLeft.toString());var n=document.getElementById("shuffleCount");n&&(n.textContent=this.boosterState.shuffleCount.toString());var o=document.getElementById("bombCount");o&&(o.textContent=this.boosterState.bombCount.toString());var r=document.getElementById("shuffleBooster"),i=document.getElementById("bombBooster");r&&(this.boosterState.shuffleCount<=0?r.classList.add("disabled"):r.classList.remove("disabled")),i&&(this.boosterState.bombCount<=0?i.classList.add("disabled"):i.classList.remove("disabled"))}},{key:"showGameOverModal",value:function(t){var e=document.getElementById("gameOverModal"),n=document.getElementById("modalTitle"),o=document.getElementById("modalMessage");e&&n&&o&&(t?(n.textContent="Поздравляем!",o.textContent="Вы выиграли! Набрано очков: ".concat(this.gameState.score)):(n.textContent="Игра окончена!",o.textContent="Вы набрали ".concat(this.gameState.score," очков")),e.style.display="flex")}},{key:"hideLoadingScreen",value:function(){var t=document.getElementById("loadingScreen"),e=document.getElementById("gameInterface");t&&e&&(t.style.display="none",e.style.display="block")}},{key:"showError",value:function(t){var e=document.getElementById("loadingScreen");e&&(e.innerHTML='\n        <div class="error-message">\n          <div class="error-text">'.concat(t,'</div>\n          <button class="retry-button" onclick="location.reload()">Попробовать снова</button>\n        </div>\n      '))}},{key:"restartGame",value:function(){this.gameState={score:0,movesLeft:this.config.maxMoves,isGameOver:!1,isProcessing:!1,bombMode:!1},this.boosterState={shuffleCount:this.config.shuffleCount,bombCount:this.config.bombCount};var t=document.getElementById("gameOverModal");t&&(t.style.display="none"),this.generateBoard(),this.updateUI()}},{key:"destroy",value:function(){this.adapter.stop()}},{key:"useShuffleBooster",value:function(){this.boosterState.shuffleCount<=0?console.log("No shuffle boosters left"):(console.log("Using shuffle booster"),this.boosterState.shuffleCount--,this.shuffleBoard(),this.updateUI())}},{key:"useBombBooster",value:function(){this.boosterState.bombCount<=0?console.log("No bomb boosters left"):(console.log("Using bomb booster"),this.boosterState.bombCount--,this.updateUI(),this.gameState.bombMode=!0)}},{key:"shuffleBoard",value:function(){var t=this;console.log("Shuffling board...");for(var e=[],n=0;n<this.config.boardWidth;n++)for(var o=0;o<this.config.boardHeight;o++){var r=this.adapter.getAllTiles().get("".concat(n,",").concat(o));r&&e.push(r)}for(var i=0;i<this.config.boardWidth;i++)for(var a=0;a<this.config.boardHeight;a++)this.adapter.removeTile(i,a);for(var c=e.length-1;c>0;c--){var s=Math.floor(Math.random()*(c+1)),l=[e[s],e[c]];e[c]=l[0],e[s]=l[1]}e.forEach(function(e,n){var o=n%t.config.boardWidth,r=Math.floor(n/t.config.boardWidth);t.adapter.createTile(o,r,e.type,e.imageSrc)}),console.log("Board shuffled")}}],e&&v(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,o,r,i}();function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function y(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function i(n,o,r,i){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return b(l,"_invoke",function(n,o,r){var i,c,s,l=0,u=r||[],f=!1,h={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,c=0,s=t,h.n=n,a}};function d(n,o){for(c=n,s=o,e=0;!f&&l&&!r&&e<u.length;e++){var r,i=u[e],d=h.p,v=i[2];n>3?(r=v===o)&&(s=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=d&&((r=n<2&&d<i[1])?(c=0,h.v=o,h.n=i[1]):d<v&&(r=n<3||i[0]>o||o>v)&&(i[4]=n,i[5]=o,h.n=v,c=0))}if(r||n>1)return a;throw f=!0,o}return function(r,u,v){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&d(u,v),c=u,s=v;(e=c<2?t:s)||!f;){i||(c?c<3?(c>1&&(h.n=-1),d(c,s)):h.n=s:h.v=s);try{if(l=2,i){if(c||(r="next"),e=i[r]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),c=1);i=t}else if((e=(f=h.n<0)?s:n.call(o,h))!==a)break}catch(e){i=t,c=1,s=e}finally{l=1}}return{value:e,done:f}}}(n,r,i),!0),l}var a={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var u=[][o]?e(e([][o]())):(b(e={},o,function(){return this}),e),f=l.prototype=c.prototype=Object.create(u);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,b(t,r,"GeneratorFunction")),t.prototype=Object.create(f),t}return s.prototype=l,b(f,"constructor",l),b(l,"constructor",s),s.displayName="GeneratorFunction",b(l,r,"GeneratorFunction"),b(f),b(f,r,"Generator"),b(f,o,function(){return this}),b(f,"toString",function(){return"[object Generator]"}),(y=function(){return{w:i,m:h}})()}function b(t,e,n,o){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}b=function(t,e,n,o){function i(e,n){b(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},b(t,e,n,o)}function S(t,e,n,o,r,i,a){try{var c=t[i](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,r)}function k(t){return function(){var e=this,n=arguments;return new Promise(function(o,r){var i=t.apply(e,n);function a(t){S(i,o,r,a,c,"next",t)}function c(t){S(i,o,r,a,c,"throw",t)}a(void 0)})}}function T(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,E(o.key),o)}}function E(t){var e=function(t){if("object"!=p(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==p(e)?e:e+""}var w=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gameManager=new g},e=[{key:"initialize",value:(n=k(y().m(function t(){return y().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.gameManager.initialize();case 1:return t.a(2)}},t,this)})),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){this.gameManager.destroy()}}],e&&T(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function C(t){var e=document.getElementById("shuffleBooster");e&&e.addEventListener("click",function(){console.log("Shuffle booster clicked"),t.gameManager.useShuffleBooster()});var n=document.getElementById("bombBooster");n&&n.addEventListener("click",function(){console.log("Bomb booster clicked"),t.gameManager.useBombBooster()})}function x(t){var e=document.getElementById("restartButton");e&&e.addEventListener("click",function(){console.log("Restart button clicked"),t.gameManager.restartGame()})}document.addEventListener("DOMContentLoaded",k(y().m(function t(){var e,n;return y().w(function(t){for(;;)switch(t.p=t.n){case 0:return e=new w,t.p=1,t.n=2,e.initialize();case 2:window.blastGame=e,C(e),x(e),t.n=4;break;case 3:t.p=3,n=t.v,console.error("Failed to initialize game:",n);case 4:return t.a(2)}},t,null,[[1,3]])})))})();